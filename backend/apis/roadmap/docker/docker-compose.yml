# ロードマップAPI用 Docker Compose設定（ローカル開発環境）

version: '3.8'

services:
  roadmap-api:
    build:
      context: ../
      dockerfile: docker/Dockerfile
    container_name: roadmap-api
    ports:
      - "8007:8000"
    environment:
      # ローカル開発環境設定
      - ENV=local
      - LOG_LEVEL=DEBUG
      - DYNAMODB_TABLE_NAME=LearningPlatform
      - DYNAMODB_ENDPOINT=http://dynamodb-local:8000
      - CORS_ORIGINS=http://localhost:3000,http://localhost:5173
      - AWS_DEFAULT_REGION=us-east-1
      - AWS_ACCESS_KEY_ID=local
      - AWS_SECRET_ACCESS_KEY=local
    volumes:
      - ../lambda:/app:delegated
    networks:
      - learning-platform
    depends_on:
      - dynamodb-local
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  dynamodb-local:
    image: amazon/dynamodb-local:latest
    container_name: dynamodb-local-roadmap
    ports:
      - "8008:8000"
    command: "-jar DynamoDBLocal.jar -sharedDb -inMemory"
    networks:
      - learning-platform
    restart: unless-stopped

networks:
  learning-platform:
    driver: bridge
    external: true

# ローカル開発用のボリューム設定
volumes:
  roadmap_data: