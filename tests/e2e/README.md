# Learning Platform - E2E Tests with Playwright

å­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®End-to-Endï¼ˆE2Eï¼‰ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã§ã™ã€‚[Playwright](https://playwright.dev/)ã‚’ä½¿ç”¨ã—ã¦Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨APIã®åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã™ã€‚

## ğŸ“‹ ãƒ†ã‚¹ãƒˆæ¦‚è¦

### ğŸ¯ ãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒª

1. **API Tests** (`tests/api/`)
   - Analytics API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æ¤œè¨¼
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

2. **UI Tests** (`tests/ui/`)
   - Analytics ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®UIãƒ†ã‚¹ãƒˆ
   - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ
   - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
   - ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

### ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
tests/e2e/
â”œâ”€â”€ package.json                 # Playwrightä¾å­˜é–¢ä¿‚
â”œâ”€â”€ playwright.config.js         # Playwrightè¨­å®š
â”œâ”€â”€ global-setup.js             # ãƒ†ã‚¹ãƒˆå‰ã®å…¨ä½“ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”œâ”€â”€ global-teardown.js          # ãƒ†ã‚¹ãƒˆå¾Œã®å…¨ä½“ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ analytics.spec.js   # Analytics API ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ analytics-dashboard.spec.js  # Analytics UI ãƒ†ã‚¹ãƒˆ
â””â”€â”€ README.md                   # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨å®Ÿè¡Œ

### å‰ææ¡ä»¶

- Node.js 18.x ä»¥ä¸Š
- npm ã¾ãŸã¯ pnpm
- Dockerï¼ˆAnalytics APIç”¨ï¼‰
- ç¨¼åƒä¸­ã®Analytics API (`http://localhost:8003`)

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# E2Eãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd tests/e2e

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm run install-browsers
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm test

# ãƒ˜ãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‚’è¡¨ç¤ºï¼‰
npm run test:headed

# UI ãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ï¼‰
npm run test:ui

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:debug

# Analytics APIãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
npm run test:analytics

# API ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
npm run test:api
```

### ãƒ†ã‚¹ãƒˆçµæœã¨ãƒ¬ãƒãƒ¼ãƒˆ

```bash
# HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º
npm run report
```

## ğŸ“Š Analytics APIãƒ†ã‚¹ãƒˆè©³ç´°

`tests/api/analytics.spec.js` ã§ã¯ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼š

### ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- `GET /health` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- `GET /` - ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ  
- `GET /analytics/weekly` - é€±æ¬¡åˆ†æãƒ‡ãƒ¼ã‚¿
- `GET /analytics/monthly-trends` - æœˆæ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿
- `GET /analytics/productivity` - ç”Ÿç”£æ€§ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- `GET /analytics/summary` - åˆ†æã‚µãƒãƒªãƒ¼
- `GET /analytics/charts/{type}` - ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿
- `GET /analytics/goals` - ç›®æ¨™è¿½è·¡ãƒ‡ãƒ¼ã‚¿
- `POST /analytics/analyze` - ã‚«ã‚¹ã‚¿ãƒ åˆ†æ

### ãƒ†ã‚¹ãƒˆå†…å®¹

- **æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ**: å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£ã—ã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã“ã¨ã‚’ç¢ºèª
- **ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ**: ç„¡åŠ¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **ãƒ‡ãƒ¼ã‚¿æ§‹é€ æ¤œè¨¼**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã¨å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç¢ºèª
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã®æ¸¬å®šï¼ˆ5ç§’ä»¥å†…ï¼‰
- **CORSç¢ºèª**: é©åˆ‡ãªCORSãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®šç¢ºèª

## ğŸ¨ UIãƒ†ã‚¹ãƒˆè©³ç´°

`tests/ui/analytics-dashboard.spec.js` ã§ã¯ä»¥ä¸‹ã®UIè¦ç´ ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼š

### ãƒ†ã‚¹ãƒˆå¯¾è±¡æ©Ÿèƒ½

- **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º**: Analytics ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®æ­£å¸¸ãªèª­ã¿è¾¼ã¿
- **ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º**: é€±æ¬¡åˆ†æãƒãƒ£ãƒ¼ãƒˆã€æœˆæ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒ£ãƒ¼ãƒˆã®è¡¨ç¤º
- **çµ±è¨ˆæƒ…å ±**: å­¦ç¿’æ™‚é–“ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã€å­¦ç¿’æ—¥æ•°ã®è¡¨ç¤º
- **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³**: æ—¥ä»˜ç¯„å›²é¸æŠã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–**: ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã§ã®é©åˆ‡ãªè¡¨ç¤º
- **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹è¡¨ç¤º
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: API ã‚¨ãƒ©ãƒ¼æ™‚ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã€ARIA ãƒ©ãƒ™ãƒ«

## âš™ï¸ è¨­å®šã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### Playwright è¨­å®š

`playwright.config.js` ã§ä»¥ä¸‹ã®è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ï¼š

- **ãƒ–ãƒ©ã‚¦ã‚¶è¨­å®š**: Chromeã€Firefoxã€Safariã€ãƒ¢ãƒã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶
- **ä¸¦åˆ—å®Ÿè¡Œ**: ãƒ†ã‚¹ãƒˆã®ä¸¦åˆ—å®Ÿè¡Œæ•°
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“
- **ãƒªãƒˆãƒ©ã‚¤**: å¤±æ•—æ™‚ã®å†è©¦è¡Œå›æ•°
- **ãƒ¬ãƒãƒ¼ãƒˆ**: HTMLã€JSONã€JUnitãƒ¬ãƒãƒ¼ãƒˆå½¢å¼

### ç’°å¢ƒå¤‰æ•°

- `CI`: CIç’°å¢ƒã§ã®å®Ÿè¡Œè¨­å®š
- `DEBUG`: ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã®æœ‰åŠ¹åŒ–
- `HEADLESS`: ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®è¨­å®š

## ğŸ³ Dockerçµ±åˆ

ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã«å¿…è¦ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’è‡ªå‹•èµ·å‹•ã—ã¾ã™ï¼š

```yaml
# docker-compose.yml ã§ä»¥ä¸‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•
services:
  - analytics-api (port: 8003)
  - dynamodb-local (port: 8004)
  - dynamodb-admin (port: 8005)
```

## ğŸ“ ãƒ†ã‚¹ãƒˆä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### APIãƒ†ã‚¹ãƒˆã®ä½œæˆ

```javascript
test('æ–°ã—ã„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ', async ({ request }) => {
  const response = await request.get('/api/new-endpoint');
  
  expect(response.ok()).toBeTruthy();
  
  const data = await response.json();
  expect(data).toHaveProperty('expectedField');
});
```

### UIãƒ†ã‚¹ãƒˆã®ä½œæˆ

```javascript
test('æ–°ã—ã„UIè¦ç´ ', async ({ page }) => {
  await page.goto('/new-page');
  
  const element = page.locator('[data-testid="new-element"]');
  await expect(element).toBeVisible();
  
  await element.click();
  await expect(page.locator('[data-testid="result"]')).toContainText('æœŸå¾…ã•ã‚Œã‚‹çµæœ');
});
```

## ğŸ” Playwrightãƒ‡ãƒãƒƒã‚°

### Playwright Inspector

```bash
# Inspector ã‚’ä½¿ã£ã¦ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ
npm run test:debug
```

### Playwright Codegen

```bash
# æ“ä½œã‚’è¨˜éŒ²ã—ã¦ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
npm run codegen http://localhost:3000
```

### ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼

```bash
# ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤º
npx playwright show-trace trace.zip
```

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Playwright å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://playwright.dev/docs/intro)
- [Playwright Test API](https://playwright.dev/docs/api/class-test)
- [Best Practices](https://playwright.dev/docs/best-practices)
- [Debugging Guide](https://playwright.dev/docs/debugging)

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ ã™ã‚‹å ´åˆï¼š

1. é©åˆ‡ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`api/` ã¾ãŸã¯ `ui/`ï¼‰ã« `.spec.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. `test.describe()` ã§ãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚’å®šç¾©
3. `test()` ã§å€‹åˆ¥ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’å®Ÿè£…
4. `expect()` ã§ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨˜è¿°
5. `npm test` ã§ãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

## ğŸ“ˆ ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

GitHub Actions ã‚„ãã®ä»–ã®CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®å®Ÿè¡Œä¾‹ï¼š

```yaml
- name: Run E2E tests
  run: |
    cd tests/e2e
    npm ci
    npm run install-browsers
    npm test
```

---

**Learning Platform E2E Testing Suite** - é«˜å“è³ªãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºä¿ã®ãŸã‚ã« ğŸš€